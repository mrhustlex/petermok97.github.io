<!-- <script src="/cropper/jquery.js"></script><!-- jQuery is required -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link  href="./cropper/dist/cropper.css" rel="stylesheet">
<script src="./cropper/dist/cropper.js"></script>

<!-- Wrap the image or canvas element with a block element (container) -->
<br>
<div id='canva' style="width:60%;max-height:70%;"">
  <input type='file' id="upload"/>
  <img id="image" src="#">
</div>
<br>
<button onclick="exportFile()">Crop</button>
<br>
<div class="result-canva">
  <img id="img" src="base_ball.png">
  <img id="img_on_ball" src="#" style="display:none;">
</div>

<style>
  /* Limit image width to avoid overflow the container */
  img {
    max-width: 100%; /* This rule is very important, please do not ignore this! */
  }

  .cropper-crop-box, .cropper-view-box {
    border-radius: 50%;
  }

  .cropper-view-box {
    box-shadow: 0 0 0 1px #39f;
    outline: 0;
  }

  .result-canva{
    position:relative;
    float: left;
  }
  #img{
    width:250px;
    z-index: 1;
    /* position:absolute; */
  }

  #img_on_ball{
    z-index: 2;
    width:80px;
    position:absolute;
    top:70px;
    left:85px;

  }
</style>

<script>

  function getRoundedCanvas(){
    var image = $('#image');
    var cropped = image.cropper('getCroppedCanvas', {width: 300, height: 300});
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    var width = cropped.width;
    var height = cropped.height;
    canvas.width = width;
    canvas.height = height;
    context.imageSmoothingEnabled = true;
    context.drawImage(cropped, 0, 0, width, height);
    context.globalCompositeOperation = 'destination-in';
    context.beginPath();
    context.arc(width / 2, height / 2, Math.min(width, height) / 2, 0, 2 * Math.PI, true);
    context.fill();
    return canvas;

  }

  function exportFile(){
    var canvas = getRoundedCanvas();
    var imageData=canvas.toDataURL("image/png");
    $('#img_on_ball').attr('src', imageData);
    $('#img_on_ball').show();
    // var arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],
    //     bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
    // while(n--){
    //     u8arr[n] = bstr.charCodeAt(n);
    // }
    // var filename='hihi';
    // var f=new File([u8arr],filename,{type:"image/png"});

  }

  function getCropImage(){
    // var cropper = image.data('cropper');
    // var cropped = image.cropper('getCroppedCanvas', {width: 100, height: 100});
    // console.log(cropped);
    var imageData = $('#image').cropper('getCroppedCanvas').toDataURL();
    $('#img_on_ball').attr('src', imageData).appendTo('body');

  }


  $(document).ready(function(){
    $('input[type="file"]').change(function(){
        $('#image').cropper('destroy');
        var input = document.getElementById('upload');
        // alert(input);
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {
            $('#image')
            .attr('src', e.target.result);
          };

          reader.readAsDataURL(input.files[0]);
        }
        $('#image').on('load', function() {
          // alert("image is loaded");
          var image = $('#image');
          var cropper = image.cropper({
            aspectRatio: 5/5,
            zoomOnWheel:false,
            viewMode:1,
            crop: function(e) {
              // console.log(e);
              // console.log(e.detail);
              // console.log(e.y);
              // console.log(e.width);
              // console.log(e.height);
              // console.log(e.rotate);
              // console.log(e.scaleX);
              // console.log(e.scaleY);
            }
          });
        });
    });
});
</script>
