<!-- <script src="/cropper/jquery.js"></script><!-- jQuery is required -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<link  href="./cropper/dist/cropper.css" rel="stylesheet">
<script src="./cropper/dist/cropper.js"></script>

<!-- Wrap the image or canvas element with a block element (container) -->
<br>
<input type='file' id="upload"/>
<br>
<!-- <button onclick="exportFile()">Crop</button> -->
<br>
<div class="result-canva container-fluid">
    <div id='canva' style="display:none;">
      <img id="image" src="#" >
    </div>
    <img id="img" src="base_ball.png">
    <img id="img_on_ball" src="#" style="display:none;">
</div>

<style>
  /* Limit image width to avoid overflow the container */
  img {
    max-width: 100%; /* This rule is very important, please do not ignore this! */
  }

  #canva{
    z-index: 3;
    position:absolute;
    top:0px;
    left:0px;
    /* width:3000px; */
    /* left:85px; */
  }

  .cropper-crop-box, .cropper-view-box {
    border-radius: 50%;
  }

  .cropper-view-box {
    box-shadow: 0 0 0 1px #39f;
    outline: 0;
    /* width: 100%; */
  }

  .result-canva{
    position:relative;
    float: left;
    width:100%;
  }
  #img{
    width:500px;
    z-index: 1;
    /* position:absolute; */
  }

  #img_on_ball{
    z-index: 2;
    width:120px;
    position:absolute;
    top:150px;
    left:190px;

  }
</style>

<script>

  function getRoundedCanvas(){
    var image = $('#image');
    var width = $('#image').width();
    var height = $('#image').height();
    var cropped = image.cropper('getCroppedCanvas', {width: 300, height: 300});
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    var width = cropped.width;
    var height = cropped.height;
    canvas.width = width;
    canvas.height = height;
    context.imageSmoothingEnabled = true;
    context.drawImage(cropped, 0, 0, width, height);
    context.globalCompositeOperation = 'destination-in';
    context.beginPath();
    context.arc(width / 2, height / 2, Math.min(width, height) / 2, 0, 2 * Math.PI, true);
    context.fill();
    return canvas;
  }

  function getDefaultCanvas(){
    var image = $('#image');
    var width = $('#image').width();
    var height = $('#image').height();
    var cropped = image.cropper('getCroppedCanvas', {width: 300, height: 300});
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');
    // var width = 150;
    // var height = 150;
    canvas.width = width;
    canvas.height = height;
    context.imageSmoothingEnabled = true;
    context.drawImage(cropped, 0, 0, width, height);
    context.globalCompositeOperation = 'destination-in';
    context.beginPath();
    context.arc(width / 2, height / 2, Math.min(width, height) / 2, 0, 2 * Math.PI, true);
    context.fill();
    return canvas;
  }

  function exportFile(){
    var canvas = getRoundedCanvas();
    var imageData=canvas.toDataURL("image/png");
    $('#img_on_ball').attr('src', imageData);
    $('#img_on_ball').show();
    document.getElementById("canva").style.display = "none";
  }


  function getCropImage(){
    var imageData = $('#image').cropper('getCroppedCanvas').toDataURL();
    $('#img_on_ball').attr('src', imageData);
  }


  $(document).ready(function(){
    // $('#canva').
    $('input[type="file"]').change(function(){
      $('#image').cropper('destroy');
      var input = document.getElementById('upload');
      // alert(input);
      if (input.files && input.files[0]) {
        var reader = new FileReader();

        reader.onload = function (e) {
          console.log($('#image'));
          $('#image').attr('src', e.target.result);
        };

        reader.readAsDataURL(input.files[0]);
      }
      $('#image').on('load', function() {
        // alert("image is loaded");
        var image = $('#image');
        var cropper = image.cropper({
          aspectRatio: 1000/1000,
          zoomOnWheel:false,
          viewMode:1,
          minContainerWidth:500,
          minContainerHeight:500,
          zoomable:true,
          crop: function(e) {
            // console.log(e);
            // console.log(e.detail);
            // console.log(e.y);
            // console.log(e.width);
            // console.log(e.height);
            // console.log(e.rotate);
            // console.log(e.scaleX);
            // console.log(e.scaleY);
          },
          built: function () {
            // image.cropper("setCropBoxData", { width: "1000", height: "500" });
            // exportFile();
          },
          ready: function (){
              exportFile();
          }
        });
      });
      // exportFile();
    });

    $('#img_on_ball').click(function(){
      if($('#canva').is(':visible')){
        document.getElementById("canva").style.display = "none";
      }else{
        document.getElementById("canva").style.display = "";
      }
    });

    $(document).mouseup(function (e){
      var container = $("#canva");

      // if the target of the click isn't the container nor a descendant of the container
      if (!container.is(e.target) && container.has(e.target).length === 0)
      {
          container.hide();
          exportFile();
      }
    });
  });
</script>
